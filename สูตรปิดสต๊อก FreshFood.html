<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สูตรคำนวนปิดสต๊อก Fresh Food (คำนวณวัน)</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #eef4f7;
            margin: 0; 
            padding: 0; 
        }
        header { 
            background-color: #00796b;
            color: white; 
            padding: 20px; 
            text-align: center; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .container { 
            padding: 20px; 
            max-width: 900px; 
            margin: auto; 
        }
        .category-group { 
            background-color: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            border-left: 5px solid #00796b;
        }
        
        .header-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .category-title { 
            font-size: 1.2em; 
            font-weight: bold; 
            color: #333; 
            margin: 0;
        }
        
        .additional-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #00796b;
            margin: 0;
        }

        .input-group { 
            margin-bottom: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        .input-group label, 
        .input-group input {
            flex: 1;
            margin-left: 5px;
            margin-right: 5px;
        }

        .input-group label {
            text-align: right;
            padding-right: 10px;
            color: #555;
        }

        .input-group input { 
            padding: 8px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            transition: border-color 0.3s;
            text-align: right;
        }

        .input-group input:focus {
            border-color: #00796b;
        }

        input[readonly] { 
            background-color: #e0f2f1;
            cursor: not-allowed; 
            font-weight: bold;
            color: #004d40;
        }

    </style>
</head>
<body>

    <header>
        <h1>สูตรคำนวนปิดสต๊อก Fresh Food</h1>
    </header>

    <div class="container">
        <!-- กลุ่ม TF Beef -->
        <div class="category-group">
            <div class="header-group">
                <div class="category-title">TF Beef</div>
                <div class="additional-title">สำหรับ TF Beef</div> 
            </div>
            
            <div class="input-group">
                <label>Sale (ยอดรวม):</label>
                <!-- ลบ value="0.00" ออก -->
                <input type="text" id="tf_sale" value="" oninput="formatNumberInput(this); calculateRow('tf_');">
                <label>Sale/วัน (คำนวณ):</label>
                <input type="text" id="tf_sale_day" readonly>
            </div>
            <div class="input-group">
                <label>Profit (ใส่ตัวเลข):</label>
                <input type="text" id="tf_profit" value="" oninput="formatNumberInput(this); calculateRow('tf_');">
                <label>Margin (ใส่ตัวเลข):</label>
                <input type="text" id="tf_margin" value="" oninput="formatNumberInput(this); calculateRow('tf_');">
            </div>
             <div class="input-group">
                <label>ยอดยิงทิ้ง (ยอดรวม):</label>
                <input type="text" id="tf_wasted_value" value="" oninput="formatNumberInput(this); calculateRow('tf_');">
                <label>ยอด ยิงทิ้ง (% จาก Sale):</label>
                <input type="text" id="tf_wasted_percent" readonly>
            </div>
            <div class="input-group">
                <label>CloseStock (ยอดรวม):</label>
                <input type="text" id="tf_closestock_value" value="" oninput="formatNumberInput(this); calculateRow('tf_');">
                <label>ยอด CloseStock (วัน):</label>
                <input type="text" id="tf_closestock_days" readonly>
            </div>
        </div>

        <!-- กลุ่ม Aust Beef -->
        <div class="category-group">
            <div class="header-group">
                <div class="category-title">Aust Beef</div>
                <div class="additional-title">สำหรับ Aust Beef</div>
            </div>
            
            <div class="input-group">
                <label>Sale (ยอดรวม):</label>
                <input type="text" id="aust_sale" value="" oninput="formatNumberInput(this); calculateRow('aust_');">
                <label>Sale/วัน (คำนวณ):</label>
                <input type="text" id="aust_sale_day" readonly>
            </div>
            <div class="input-group">
                <label>Profit (ใส่ตัวเลข):</label>
                <input type="text" id="aust_profit" value="" oninput="formatNumberInput(this); calculateRow('aust_');">
                <label>Margin (ใส่ตัวเลข):</label>
                <input type="text" id="aust_margin" value="" oninput="formatNumberInput(this); calculateRow('aust_');">
            </div>
             <div class="input-group">
                <label>ยอดยิงทิ้ง (ยอดรวม):</label>
                <input type="text" id="aust_wasted_value" value="" oninput="formatNumberInput(this); calculateRow('aust_');">
                <label>ยอด ยิงทิ้ง (% จาก Sale):</label>
                <input type="text" id="aust_wasted_percent" readonly>
            </div>
            <div class="input-group">
                <label>CloseStock (ยอดรวม):</label>
                <input type="text" id="aust_closestock_value" value="" oninput="formatNumberInput(this); calculateRow('aust_');">
                <label>ยอด CloseStock (วัน):</label>
                <input type="text" id="aust_closestock_days" readonly>
            </div>
        </div>

        <!-- Andaman Local -->
        <div class="category-group">
            <div class="header-group">
                <div class="category-title">Andaman Local</div>
                <div class="additional-title">สำหรับ Andaman Local</div> 
            </div>
            <div class="input-group">
                <label>Sale (ยอดรวม):</label>
                <input type="text" id="andaman_sale" value="" oninput="formatNumberInput(this); calculateRow('andaman_');">
                <label>Sale/วัน (คำนวณ):</label>
                <input type="text" id="andaman_sale_day" readonly>
            </div>
            <div class="input-group">
                <label>Profit (ใส่ตัวเลข):</label>
                <input type="text" id="andaman_profit" value="" oninput="formatNumberInput(this); calculateRow('andaman_');">
                <label>Margin (ใส่ตัวเลข):</label>
                <input type="text" id="andaman_margin" value="" oninput="formatNumberInput(this); calculateRow('andaman_');">
            </div>
             <div class="input-group">
                <label>ยอดยิงทิ้ง (ยอดรวม):</label>
                <input type="text" id="andaman_wasted_value" value="" oninput="formatNumberInput(this); calculateRow('andaman_');">
                <label>ยอด ยิงทิ้ง (% จาก Sale):</label>
                <input type="text" id="andaman_wasted_percent" readonly>
            </div>
            <div class="input-group">
                <label>CloseStock (ยอดรวม):</label>
                <input type="text" id="andaman_closestock_value" value="" oninput="formatNumberInput(this); calculateRow('andaman_');">
                <label>ยอด CloseStock (วัน):</label>
                <input type="text" id="andaman_closestock_days" readonly>
            </div>
        </div>
        
        <!-- Imp. Seafood -->
        <div class="category-group">
            <div class="header-group">
                <div class="category-title">Imp. Seafood</div>
                <div class="additional-title">สำหรับ Imp. Seafood</div> 
            </div>
            <div class="input-group">
                <label>Sale (ยอดรวม):</label>
                <input type="text" id="impseafood_sale" value="" oninput="formatNumberInput(this); calculateRow('impseafood_');">
                <label>Sale/วัน (คำนวณ):</label>
                <input type="text" id="impseafood_sale_day" readonly>
            </div>
            <div class="input-group">
                <label>Profit (ใส่ตัวเลข):</label>
                <input type="text" id="impseafood_profit" value="" oninput="formatNumberInput(this); calculateRow('impseafood_');">
                <label>Margin (ใส่ตัวเลข):</label>
                <input type="text" id="impseafood_margin" value="" oninput="formatNumberInput(this); calculateRow('impseafood_');">
            </div>
             <div class="input-group">
                <label>ยอดยิงทิ้ง (ยอดรวม):</label>
                <input type="text" id="impseafood_wasted_value" value="" oninput="formatNumberInput(this); calculateRow('impseafood_');">
                <label>ยอด ยิงทิ้ง (% จาก Sale):</label>
                <input type="text" id="impseafood_wasted_percent" readonly>
            </div>
            <div class="input-group">
                <label>CloseStock (ยอดรวม):</label>
                <input type="text" id="impseafood_closestock_value" value="" oninput="formatNumberInput(this); calculateRow('impseafood_');">
                <label>ยอด CloseStock (วัน):</label>
                <input type="text" id="impseafood_closestock_days" readonly>
            </div>
        </div>

        <!-- Delica imp. Couter -->
        <div class="category-group">
            <div class="header-group">
                <div class="category-title">Delica imp. Couter</div>
                <div class="additional-title">สำหรับ Delica imp. Couter</div> 
            </div>
            <div class="input-group">
                <label>Sale (ยอดรวม):</label>
                <input type="text" id="delicaimp_sale" value="" oninput="formatNumberInput(this); calculateRow('delicaimp_');">
                <label>Sale/วัน (คำนวณ):</label>
                <input type="text" id="delicaimp_sale_day" readonly>
            </div>
            <div class="input-group">
                <label>Profit (ใส่ตัวเลข):</label>
                <input type="text" id="delicaimp_profit" value="" oninput="formatNumberInput(this); calculateRow('delicaimp_');">
                <label>Margin (ใส่ตัวเลข):</label>
                <input type="text" id="delicaimp_margin" value="" oninput="formatNumberInput(this); calculateRow('delicaimp_');">
            </div>
             <div class="input-group">
                <label>ยอดยิงทิ้ง (ยอดรวม):</label>
                <input type="text" id="delicaimp_wasted_value" value="" oninput="formatNumberInput(this); calculateRow('delicaimp_');">
                <label>ยอด ยิงทิ้ง (% จาก Sale):</label>
                <input type="text" id="delicaimp_wasted_percent" readonly>
            </div>
            <div class="input-group">
                <label>CloseStock (ยอดรวม):</label>
                <input type="text" id="delicaimp_closestock_value" value="" oninput="formatNumberInput(this); calculateRow('delicaimp_');">
                <label>ยอด CloseStock (วัน):</label>
                <input type="text" id="delicaimp_closestock_days" readonly>
            </div>
        </div>

         <!-- Delica Local -->
        <div class="category-group">
            <div class="header-group">
                <div class="category-title">Delica Local</div>
                <div class="additional-title">สำหรับ Delica Local</div> 
            </div>
            <div class="input-group">
                <label>Sale (ยอดรวม):</label>
                <input type="text" id="delicalocal_sale" value="" oninput="formatNumberInput(this); calculateRow('delicalocal_');">
                <label>Sale/วัน (คำนวณ):</label>
                <input type="text" id="delicalocal_sale_day" readonly>
            </div>
            <div class="input-group">
                <label>Profit (ใส่ตัวเลข):</label>
                <input type="text" id="delicalocal_profit" value="" oninput="formatNumberInput(this); calculateRow('delicalocal_');">
                <label>Margin (ใส่ตัวเลข):</label>
                <input type="text" id="delicalocal_margin" value="" oninput="formatNumberInput(this); calculateRow('delicalocal_');">
            </div>
             <div class="input-group">
                <label>ยอดยิงทิ้ง (ยอดรวม):</label>
                <input type="text" id="delicalocal_wasted_value" value="" oninput="formatNumberInput(this); calculateRow('delicalocal_');">
                <label>ยอด ยิงทิ้ง (% จาก Sale):</label>
                <input type="text" id="delicalocal_wasted_percent" readonly>
            </div>
            <div class="input-group">
                <label>CloseStock (ยอดรวม):</label>
                <input type="text" id="delicalocal_closestock_value" value="" oninput="formatNumberInput(this); calculateRow('delicalocal_');">
                <label>ยอด CloseStock (วัน):</label>
                <input type="text" id="delicalocal_closestock_days" readonly>
            </div>
        </div>
    </div>

    <script>
        // ฟังก์ชันสำหรับใส่ comma ใน input type="text"
        function formatNumberInput(input) {
            // ลบ comma เดิมออกก่อน
            let value = input.value.replace(/,/g, '');
            
            // ตรวจสอบว่าเป็นตัวเลขที่ถูกต้องหรือไม่
            if (!isNaN(value) && value !== '') {
                // แยกส่วนจำนวนเต็มและทศนิยม
                const parts = value.split('.');
                let integerPart = parts[0];
                let decimalPart = parts.length > 1 ? '.' + parts[1] : '';

                // ใช้ toLocaleString เพื่อเพิ่ม comma ในส่วนจำนวนเต็ม
                integerPart = parseFloat(integerPart).toLocaleString('en-US', {maximumFractionDigits: 0});
                
                // รวมกลับเข้าด้วยกัน
                input.value = integerPart + decimalPart;
            } else if (value === '') {
                 // ถ้าช่องว่าง ให้คงไว้เป็นช่องว่าง
                 input.value = '';
            }
        }

        // ฟังก์ชันคำนวณหลัก ปรับปรุงให้ดึงค่าโดยการลบ comma ออก
        function calculateRow(prefix) {
            const saleInput = document.getElementById(prefix + 'sale');
            if (!saleInput) return;

            // ดึงค่าจริงที่เป็นตัวเลขโดยการลบ comma ออกก่อนคำนวณ (ถ้าช่องว่างจะแปลงเป็น 0)
            const sale = parseFloat(saleInput.value.replace(/,/g, '')) || 0;
            const wastedValue = parseFloat(document.getElementById(prefix + 'wasted_value').value.replace(/,/g, '')) || 0;
            const closestockValue = parseFloat(document.getElementById(prefix + 'closestock_value').value.replace(/,/g, '')) || 0;
            
            const saleDayInput = document.getElementById(prefix + 'sale_day');
            const wastedPercentInput = document.getElementById(prefix + 'wasted_percent');
            const closestockDaysInput = document.getElementById(prefix + 'closestock_days');

            const salePerDay = sale / 7;
            const wastedPercent = (wastedValue / sale) * 100;
            const closestockDays = closestockValue / salePerDay;

            // แสดงผลลัพธ์ในช่อง readonly โดยใช้ toLocaleString() หรือแสดงเป็นช่องว่างถ้าค่าเป็น 0 หรือ NaN
            saleDayInput.value = (salePerDay === 0 || isNaN(salePerDay)) ? '' : salePerDay.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            if (!isFinite(wastedPercent)) {
                wastedPercentInput.value = ''; // หรือ N/A
            } else {
                wastedPercentInput.value = wastedPercent.toFixed(2) + '%';
            }
            
            if (!isFinite(closestockDays) || closestockDays <= 0) {
                 closestockDaysInput.value = ''; // หรือ N/A
            } else {
                 closestockDaysInput.value = closestockDays.toFixed(2) + ' วัน';
            }
        }

        // ไม่ต้องเรียก calculateRow ทันทีที่โหลดหน้าเว็บ เพราะต้องการให้ช่องเริ่มต้นว่างเปล่า
        // calculateRow('tf_');
        // calculateRow('aust_');
        // ... (ลบการเรียกใช้เริ่มต้นออกทั้งหมด)
    </script>

</body>
</html>
